<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        .dataTables_filter input {
            background: #fefefe;
            border: none;
            font: 12px/12px 'HelveticaNeue', Helvetica, Arial, sans-serif;
            padding: 10px;
            width: 216px;
            box-shadow: 0 0 4px rgba(0, 0, 0, .4) inset, 1px 1px 1px rgba(255, 255, 255, .75);
            -moz-box-shadow: 0 0 4px rgba(0, 0, 0, .4) inset, 1px 1px 1px rgba(255, 255, 255, .75);
            -webkit-box-shadow: 0 0 4px rgba(0, 0, 0, .4) inset, 1px 1px 1px rgba(255, 255, 255, .75);
            border-radius: 9px;
            -moz-border-radius: 9px;
            -webkit-border-radius: 9px
        }

        .dataTables_filter input:focus {
            outline: none;
            box-shadow: 0 0 4px #0d76be inset;
            -moz-box-shadow: 0 0 4px #0d76be inset;
            -webkit-box-shadow: 0 0 4px #0d76be inset;
        }

        .dataTables_filter input::-webkit-input-placeholder {
            font-style: italic;
            line-height: 15px
        }

        .dataTables_filter input:-moz-placeholder {
            font-style: italic;
            line-height: 15px
        }

        table.dataTable tbody>tr.selected,
        table.dataTable tbody>tr>.selected {
            background-color: #cfd5dc !important;
        }
        /* Start by setting display:none to make this hidden.
   Then we position it in relation to the viewport window
   with position:fixed. Width, height, top and left speak
   for themselves. Background we set to 80% white with
   our animation centered, and no-repeating */

        .loader {
            display: none;
            position: fixed;
            z-index: 1000;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            background: rgba( 255, 255, 255, .8) url('http://i.stack.imgur.com/FhHRx.gif') 50% 50% no-repeat;
        }
        /* When the body has the loading class, we turn
   the scrollbar off with overflow:hidden */

        body.loading {
            overflow: hidden;
        }
        /* Anytime the body has the loading class, our
   modal element will be visible */

        body.loading .loader {
            display: block;
        }
    </style>
    <title>Admin Panel| MediBot</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"> -->
    <!-- Ionicons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">


    <link rel="stylesheet" href="bower_components/slick-carousel/slick/slick.css">
    <link rel="stylesheet" href="bower_components/slick-carousel/slick/slick-theme.css">

    <script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
    <script src="bower_components/angular/angular.js"></script>
    <script src="bower_components/slick-carousel/slick/slick.js"></script>
    <script src="bower_components/angular-slick-carousel/dist/angular-slick.min.js"></script>
    <meta http-equiv="X-UA-Compatible" content="IE=11" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-moment/1.0.1/angular-moment.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-cookies.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-google-chart/0.1.0/ng-google-chart.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.0-beta.2/angular-sanitize.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert-dev.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css">
    <script src="bower_components/bootstrapNews/jquery.bootstrap.newsbox.min.js" type="text/javascript"></script>
    <!--<script src="components/core-min.js"></script>-->
    <!--<script type="text/javascript" src="https://cdn.rawgit.com/ricmoo/aes-js/e27b99df/index.js"></script>-->
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.7.0/js/md5.js"></script>
    <script src="jsencrypt.js"></script>-->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Font Awesome -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/2.5.0/ui-bootstrap-tpls.min.js"></script>

    <!-- Bootstrap -->
    <link href="vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- NProgress -->
    <link href="vendors/nprogress/nprogress.css" rel="stylesheet">
    <!-- iCheck -->
    <link href="vendors/iCheck/skins/flat/green.css" rel="stylesheet">
    <!-- Datatables -->

    <script src="bower_components/DataTable/angular-datatables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.11/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" href="bower_components/DataTable/datatables.bootstrap.css">
    <!-- <link rel="stylesheet" type="text/css" href="Content/bower_components/DataTable/buttons.datatables.min.css" /> -->
    <script src="bower_components/DataTable/dataTables.buttons.min.js"></script>
    <script src="bower_components/DataTable/buttons.colVis.min.js"></script>
    <script src="bower_components/DataTable/buttons.flash.min.js"></script>
    <script src="bower_components/DataTable/buttons.print.min.js"></script>
    <script src="bower_components/DataTable/buttons.html5.min.js"></script>
    <script src="bower_components/DataTable/angular-datatables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/select/1.1.2/js/dataTables.select.min.js"></script>
    <script src="js/altEditor/dataTables.altEditor.free.js"></script>
    <!-- Custom Theme Style -->
    <link href="css/custom.min.css" rel="stylesheet">
</head>

<body class="nav-md">

    <div class="container body">
        <div class="main_container">
            <div class="col-md-3 left_col">
                <div class="left_col scroll-view">
                    <div class="navbar nav_title" style="border: 0;">
                        <a href="service" class="site_title">
                            <i class="fa fa-paw"></i>
                            <span>Medibot Admin Panel</span>
                        </a>
                    </div>

                    <div class="clearfix"></div>

                    <!-- menu profile quick info -->
                    <div class="profile clearfix">
                        <div class="profile_pic">
                            <img src="images/img.jpg" alt="..." class="img-circle profile_img">
                        </div>
                        <div class="profile_info">
                            <span>Welcome,</span>
                            <h2>{{user.firstname }} {{user.lastname}}</h2>
                            <a style="color: aliceblue;" href="logout">
                                <span class="fa fa-user"></span>Logout</a>
                        </div>
                    </div>
                    <!-- /menu profile quick info -->

                    <br />

                    <!-- sidebar menu -->
                    <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
                        <div class="menu_section">
                            <h3>General</h3>
                            <ul class="nav side-menu">
                                <li>
                                    <a>
                                        <i class="fa fa-home"></i> Home
                                        <span class="fa fa-chevron-down"></span>
                                    </a>
                                    <ul class="nav child_menu">
                                        <li>
                                            <a href="dashboard">Home</a>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <!-- /sidebar menu -->

                    <!-- /menu footer buttons -->
                    <div class="sidebar-footer hidden-small">
                        <a data-toggle="tooltip" data-placement="top" title="Settings">
                            <span class="glyphicon glyphicon-cog" aria-hidden="true"></span>
                        </a>
                        <a data-toggle="tooltip" data-placement="top" title="FullScreen">
                            <span class="glyphicon glyphicon-fullscreen" aria-hidden="true"></span>
                        </a>
                        <a data-toggle="tooltip" data-placement="top" title="Lock">
                            <span class="glyphicon glyphicon-eye-close" aria-hidden="true"></span>
                        </a>
                        <a data-toggle="tooltip" data-placement="top" title="Logout" href="login.html">
                            <span class="glyphicon glyphicon-off" aria-hidden="true"></span>
                        </a>
                    </div>
                    <!-- /menu footer buttons -->
                </div>
            </div>



            <!-- page content -->
            <div class="right_col" role="main">
                <div class="">
                    <div class="clearfix"></div>
                    <!-- Button trigger modal -->

                    <div class="row">
                        <div class="col-md-12 col-sm-12 col-xs-12">
                            <div class="x_panel">
                                <div class="x_title">
                                    <h2>Knowledge Base
                                        <small>For Chatbot :)</small>
                                    </h2>
                                    <ul class="nav navbar-right panel_toolbox">
                                        <li>
                                            <a class="collapse-link">
                                                <i class="fa fa-chevron-up"></i>
                                            </a>
                                        </li>
                                        <li class="dropdown">
                                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
                                                <i class="fa fa-wrench"></i>
                                            </a>
                                            <ul class="dropdown-menu" role="menu">
                                                <li>
                                                    <a href="#">Settings 1</a>
                                                </li>
                                                <li>
                                                    <a href="#">Settings 2</a>
                                                </li>
                                            </ul>
                                        </li>
                                        <li>
                                            <a class="close-link">
                                                <i class="fa fa-close"></i>
                                            </a>
                                        </li>
                                    </ul>
                                    <div class="clearfix"></div>
                                </div>

                                <div class="x_content">


                                    <table cellpadding="0" cellspacing="0" border="0" class="dataTable table table-striped table-bordered jambo_table" id="example">

                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /page content -->

            <!-- footer content -->
            <footer>
                <div class="pull-right">
                    Gentelella - Bootstrap Admin Template by
                    <a href="https://colorlib.com">Colorlib</a>
                </div>
                <div class="clearfix"></div>
            </footer>
            <!-- /footer content -->
        </div>
    </div>
    <script src="ChatBotApp/ExternalModule/AngularScrollDown.js"></script>
    <script src="ChatBotApp/ExternalModule/angular-uuid.js"></script>
    <script src="ChatBotApp/ExternalModule/Xml2Json.js"></script>
    <script src="ChatBotApp/App/ChatBotApp.js"></script>
    <script src="ChatBotApp/Services/GetKB.js"></script>
    <script src="ChatBotApp/Services/XMLDataReaderService.js"></script>
    <!-- <script src="ChatBotApp/Services/fallbackService.js"></script> -->
    <script src="ChatBotApp/Config/AppConfig.js"></script>
    <script src="ChatBotApp/Controller/ChatBotController.js"></script>
    <!-- jQuery -->
    <!-- <script src="../vendors/jquery/dist/jquery.min.js"></script> -->
    <!-- Bootstrap -->
    <script src="vendors/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- FastClick -->
    <script src="vendors/fastclick/lib/fastclick.js"></script>
    <!-- NProgress -->
    <script src="vendors/nprogress/nprogress.js"></script>
    <!-- iCheck -->
    <script src="vendors/iCheck/icheck.min.js"></script>
    <!-- Datatables -->
    <script>
        var dataset = []

        function view(that) {
            var data = $(that).closest("tr").find("td")
            localStorage.setItem("service", data[0].innerHTML);
            window.location.replace("service");
        };

        function Delete(that) {
            if (confirm("Are you sure you want delete this service")) {
                console.log("in")
                var data = $(that).closest("tr").find("td");
                var settings = {
                    "async": true,
                    "crossDomain": true,
                    "url": "/removeService?user="+"{{user.username}}"+"&service=" + data[0].innerHTML,
                    "method": "GET",
                    "headers": {
                        "content-type": "application/json",
                        "authorization": "Basic YWRtaW46QXJjc29mdGVjaEAyODk0",
                    },
                    "processData": false,
                    "data": "{\"name\" :\"Advil\",\n\t\"_url\":\"www.advil.com/faqs\",\n\t\"user\":\"arcsoftech\"\n}"
                }

                $.ajax(settings).done(function (response) {
                    var table = $('#example').DataTable();
                    table.row($(that).closest("tr")).remove().draw()
                });

            }

        };

        function createService() {
            $('#myModalNorm').modal('hide');
            activeLoader()

            var servicename = $("#service").val()
            var url = $("#url").val()
            var object = {
                name: servicename,
                _url: url,
                user: "{{user.username}}"
            }
            var settings = {
                "async": true,
                "crossDomain": true,
                "url": "/extract",
                "method": "POST",
                "headers": {
                    "content-type": "application/json",

                },
                "processData": false,
                "data": JSON.stringify(object)
            }

            console.log(settings)
            $.ajax(settings).done(function (response) {
                inactiveLoader()
                console.log("Response",JSON.parse(response))
                swal("Faq Extraction Succesfull", "faq crawled:" + JSON.parse(response).body['FaqCrawled'],
                    "success")


                $("#url").val("");
                $("#service").val("");
                myTable.row.add([servicename, "justNow",
                    '<button onclick="view(this)" class="  btn btn-primary "><i class="fa fa-eye" aria-hidden="true"></i><br>View</button><button onclick="Delete(this)" class="btn btn-danger "><i class="fa fa-trash-o " aria-hidden="true"></i><br>Delete</button>'
                ]).draw();


            }).fail(function (response) {
                inactiveLoader()


                swal({
                        title: "Timeout",
                        text: "Request Timeout",
                        type: "error"
                    },
                    function () {
                        location.reload();
                    }
                );

            });
        }
        $(document).ready(function () {


            activeLoader = function () {
                $('body').addClass("loading");
            }
            inactiveLoader = function () {
                $('body').removeClass("loading");
            }
            var columnDefs = [{
                title: "ServiceName"
            }, {
                title: "Last Modified"
            }, {
                title: "Action"
            }];
            var settings = {
                "async": true,
                "crossDomain": true,
                "url": "/getServiceList?user="+"{{user.username}}",
                "method": "GET",
                "headers": {
                    "authorization": "Basic YWRtaW46QXJjc29mdGVjaEAyODk0",
                    "cache-control": "no-cache"
                }
            }


            myTable = $('#example').DataTable({

                sPaginationType: "full_numbers",
                processing: true,
                columns: columnDefs,
                dom: 'Bfrtip', // Needs button container
                select: 'single',
                responsive: true,
                altEditor: true, // Enable altEditor
                buttons: [{
                    text: '<i class="fa fa-plus-square  fa-2x" aria-hidden="true"></i><br>Add',
                    // name: 'add', // do not change name
                    className: 'btn btn-app',
                    action: function (config) {
                        $('#myModalNorm').modal('show');
                    }
                }]

            });


            $.ajax(settings).done(function (response) {
                console.log(response)
                response.forEach(function (element) {
                    myTable.row.add([element[0], element[1],
                        '<button onclick="view(this)" class="  btn btn-primary "><i class="fa fa-eye" aria-hidden="true"></i><br>View</button><button onclick="Delete(this)" class="btn btn-danger "><i class="fa fa-trash-o " aria-hidden="true"></i><br>Delete</button>'
                    ]).draw();

                }, this);
            });




        });
    </script>

    <!-- Custom Theme Scripts -->
    <script src="js/custom.min.js"></script>
    <!-- <ng-app ng-app="ChatBot">
        <ng-controller id="ctrl" ng-controller="ChatBotController">
    </ng-controller id="ctrl" ng-controller="ChatBotController"> -->
    <div class="loader">
        <!-- Place at bottom of page -->
    </div>
    <div class="modal fade" id="myModalNorm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="myModalLabel">
                        Modal title
                    </h4>
                </div>

                <!-- Modal Body -->
                <div class="modal-body">


                    <div class="form-group">
                        <label for="ServiceName">Service Name</label>
                        <input id="service" type="text" class="form-control" id="sericeName" placeholder="Enter Service Name" />
                    </div>
                    <div class="form-group">
                        <label for="URL">FAQ URL</label>
                        <input id="url" type="text" class="form-control" id="URL" placeholder="FAQ URL" />
                    </div>
                    <button onclick="createService()" type="submit" class="btn btn-default">Create</button>



                </div>

                <!-- Modal Footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">
                        Close
                </div>
            </div>
        </div>
    </div>

</body>

</html>